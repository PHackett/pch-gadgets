<?xml version="1.0" encoding="UTF-8" ?>
<Module>

	<ModulePrefs
		title="Fixtures - All years"
		author="Paul Hackett"
		author_email="TRCCGadgets@paulhackett.com"
		description="For the rendering of TRCC fixure lists for all years we have data on."
		thumbnail="http://pch-gadgets.googlecode.com/svn/trunk/pch-gadgets/TRCC/images/TRCC-Shield.png"
		width="700"
		height="500"
		scrolling="true">
	</ModulePrefs>

	<UserPref name="linkTarget" display_name="Link URL target" datatype="string" default_value=""/>

	<Content type="html">

		<![CDATA[
			<!--
			Global CSS 
			-->
			<link href="http://pch-gadgets.googlecode.com/svn/trunk/pch-gadgets/TRCC/css/trcc.css" rel="stylesheet" type="text/css">

			<!--
			Placeholder where the generated content will be placed 
			-->
			<div id="content_div"></div>

			<!--
			Include my utilities libraries
			-->
			<script src="http://pch-gadgets.googlecode.com/svn/trunk/pch-gadgets/utils/GGUtils.js" type="text/javascript"></script>
			<script src="http://pch-gadgets.googlecode.com/svn/trunk/pch-gadgets/utils/GGGadget.js" type="text/javascript"></script>
			<script src="http://pch-gadgets.googlecode.com/svn/trunk/pch-gadgets/TRCC/objects/TeamsInYear.js" type="text/javascript"></script>


			<script type="text/javascript">

				//--------------------------------------------------------[getTRData]-
				// Returns the text for the "<TR>" string
				//
				// @param aIndex IN Line index
				//
				// @return Constructed <tr> line
				//--------------------------------------------------------------------
				function getTRData (aIndex)
				{
					var lRet="<tr>";
					
					if (!(aIndex % 2))
					{
						lRet = "<tr class='GadgetFixtureAltLine'>";
					}

					return (lRet);
				}

			
				//-------------------------------------------------------[renderData]-
				// Render the XML
				//
				// @param response IN The XML whose data we are to render as HTML
				//--------------------------------------------------------------------
				function renderData (response)
				{
					if (response == null || typeof(response) != "object" || response.firstChild == null)
					{
						_gel("content_div").innerHTML = "<i>Invalid data.</i>";
						return;
					}
				
					//
					// Get the user preferences
					//
					var lPrefs = new _IG_Prefs();
					
					GGUtils_setLinkTarget (lPrefs.getString ("linkTarget"));
					
					//
					// Parse the data
					//
					var lTeamYears=new Array();
					
					GGTRCC_LoadTeamYearsFromXML (response, lTeamYears);
					
					var lHTML="";

					//
					// Start building HTML string that will be displayed in <div>.
					//
					lHTML += "<table border='0' cellpadding='5' cellspacing='0' width='100%'>";
					
					//
					// Now down all the entries ...
					//
					for (var i=0 ; i<lTeamYears.length ; ++i)
					{
						//
						// We can now write the line out
						//
						lHTML += getTRData (i);
						
						lHTML += "<td";
						if (0 == i)
						{
							lHTML += " class='GadgetContentHeading'";
						}

						lHTML += ">" + lTeamYears[i].year() + "</td>";
						
						lHTML += "<td>" + lTeamYears[i].saturdayHTML() + "<td>"; 
						lHTML += "<td>" + lTeamYears[i].sundayHTML() + "<td>"; 
			
						lHTML += "</tr>";
					}

					//
					// End the table
					//
					lHTML += "</table>";
					
					//
					// Display HTML string in <div>
					//
					_gel('content_div').innerHTML = lHTML;
				}
				
				//----------------------------------------------------------[display]-
				// Load the XML & call the renderer
				//--------------------------------------------------------------------
				function display()
				{
					//
					// XML data for TRCC fixure years
					//
					var url = gGGGadget_Root + "TRCC/data/fixtures/fixtureYearsDB.xml";
					
					//
					// Get the XML - Callback to function renderData when complete
					//
					_IG_FetchXmlContent(url, renderData);
				}

				_IG_RegisterOnloadHandler(display);

			</script>
		]]>
	</Content>
</Module>
