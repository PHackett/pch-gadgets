<?xml version="1.0" encoding="UTF-8" ?>
<Module>

	<ModulePrefs
		title="Fixtures for a given year"
		author="Paul Hackett"
		author_email="TRCCGadgets@paulhackett.com"
		description="For the rendering of TRCC fixure lists for a specific year."
		thumbnail="http://pch-gadgets.googlecode.com/svn/trunk/pch-gadgets/TRCC/images/TRCC-Shield.png"
		width="700"
		height="500"
		scrolling="true">
	</ModulePrefs>

	<UserPref name="linkToNewWindow" display_name="Open links in new window?" datatype="bool" default_value="true"/>
	<UserPref name="year" display_name="For which year?" datatype="string" default_value="2008"/>
	<UserPref name="team" display_name="Which team?" datatype="enum" default_value="Sunday">
		<EnumValue value="Saturday" />
		<EnumValue value="Sunday" />
	</UserPref>

	<Content type="html">

		<![CDATA[
			<style type="text/css">
				.GadgetFixtureAltLine { background-color: lightblue;}
				.GadgetContentHeading { font-family: "Comic Sans MS", "Arial Black", "Arial", "Helvetica", "helv", "sans-serif";
										font-size: x-large;
										color: DarkBlue;
									  }
			</style>

			<div id="content_div"></div>

			<!--
			Include my utilities library
			-->
			<script src="http://pch-gadgets.googlecode.com/svn/trunk/pch-gadgets/utils/GGUtils.js" type="text/javascript"></script>
			<script src="http://pch-gadgets.googlecode.com/svn/trunk/pch-gadgets/TRCC/objects/Fixture.js" type="text/javascript"></script>

			<script type="text/javascript">

				var gLinkToNewWindow=false;
				var gTeam="Sunday";
				var gYear="2008";
				var gNBSP="nbsp";
	
	
				//--------------------------------------------------------[getTRData]-
				// Returns the text for the "<TR>" string
				//
				// @param aIndex IN Line index
				//
				// @return Constructed <tr> line
				//--------------------------------------------------------------------
				function getTRData (aIndex)
				{
					var lRet="<tr>";
					
					if (!(aIndex % 2))
					{
						lRet = "<tr class='GadgetFixtureAltLine'>";
					}
		
					return (lRet);
				}

				//--------------------------------------------------------[getTRData]-
				// Returns the text for the "<TR>" string
				//
				// @param aIndex IN Line index
				//
				// @return Constructed <tr> line
				//--------------------------------------------------------------------
				function makeTeamYearLink (aYear, aTeam)
				{
					var lRet="";
					var lBaseURL="http://www.paulhackett.plus.com/websites/trcc/Fixtures/FixturesByYear.html";
					
					lRet += "<a href='" + lBaseURL + "?year=" + aYear + "+DOW=" + aTeam;
					
					if (gLinkToNewWindow)
					{
						lRet += "' target='_blank'";
					}
					
					lRet += ">" + aTeam + GGUtils_DOWNumToString(2) + "</a>";
					
					return (lRet);
				}

	
				//---------------------------------------------------[renderTeamLink]-
				// Returns the text for the "<td>" string for the team
				//
				// @param aExists IN Does the information exist?
				// @param aYear IN Year that this data is for
				// @param aTeam IN "Saturday", "Sunday"
				//
				// @return Constructed <td> line
				//--------------------------------------------------------------------
				function renderTeamLink (aExists, aYear, aTeam)
				{
					var lRet="<td>&nbsp;</td>";
					
					if (aExists)
					{
						lRet = "<td>" + makeTeamYearLink (aYear, aTeam) + "</td>";
					}
					
					return (lRet);
				}


				//---------------------------------------------------[processFixture]-
				// Process a single fixture in to HTML
				//
				// @param aFixture IN The fixture XML we are to render as HTML
				// @param aIndex IN The index of the fixture
				//
				// @return The rendered fixture data
				//--------------------------------------------------------------------
				function processFixture (aFixtureXML, aIndex)
				{
					var lRet="";
					
					//
					// Parse the fixture
					//
					var lFixture = new GGTRCC_FixtureO (aFixtureXML);
					
					//
					// Start the <tr>
					//
					lRet += getTRData (aIndex);
					
					//
					// Add in the data
					//
					lRet += "<td>" + lFixture.VenueHTML() + "</td>";
					lRet += "<td>" + lFixture.DateHTML() + "</td>";
					lRet += "<td>" + lFixture.OppoHTML() + "</td>";
					lRet += "<td>" + lFixture.TimeHTML() + "</td>";
					lRet += "<td>" + lFixture.ResultHTML() + "</td>";
					
					//
					// Terminate the row
					//
					lRet += "</tr>";
					
					return (lRet);
				}


				//-------------------------------------------------------[renderData]-
				// Render the XML
				//
				// @param response IN The XML whose data we are to render as HTML
				//--------------------------------------------------------------------
				function renderData (response)
				{
					if (response == null || typeof(response) != "object" || response.firstChild == null)
					{
						_gel("content_div").innerHTML = "<i>Invalid data.</i>";
						return;
					}
					
					var lPrefs=new _IG_Prefs();
					
					if (lPrefs.getBool("linkToNewWindow")==true)
					{
						gLinkToNewWindow = true;
					}
					
					var lHTML="";
					
					//
					// Start building HTML string that will be displayed in <div>.
					//
					lHTML += "<table border='0' cellpadding='5' cellspacing='0' width='100%'>";
					
					//
					// Down all the fixtures
					//
					var lFixtures=response.getElementsByTagName ("Fixture");
					
					for (var i=0 ; i<lFixtures.length ; ++i)
					{
						lHTML += processFixture (lFixtures[i], i);
					}
					
					//
					// End the table
					//
					lHTML += "</table>";
					
					//
					// Display HTML string in <div>
					//
					_gel('content_div').innerHTML = lHTML;
				}

				//-------------------------------------------------[processUserPrefs]-
				// Process the user preferences
				//--------------------------------------------------------------------
				function processUserPrefs ()
				{
					var lPrefs=new _IG_Prefs();
					
					if (lPrefs.getBool("linkToNewWindow")==true)
					{
						gLinkToNewWindow = true;
					}
					else
					{
						gLinkToNewWindow = false;
					}
					
					gTeam = lPrefs.getString ("team");
					gYear = lPrefs.getString ("year");
				}
				
				
				//----------------------------------------------------------[display]-
				// Load the XML & call the renderer
				//--------------------------------------------------------------------
				function display()
				{
					var lBaseURL = "http://www.paulhackett.plus.com/websites/trcc/Fixtures/";
					
					//
					// Read the user prefs
					//
					processUserPrefs ();
					
					var lXMLURL=lBaseURL + gYear + "/" + gTeam + "_Fixtures_Data.xml";
					
					//
					// XML data for TRCC fixure years
					//
					var url = lBaseURL + "fixtureYearsDB.xml";
					
					//
					// Get the XML - Callback to function renderData when complete
					//
					_IG_FetchXmlContent(lXMLURL, renderData);
				}
	
				_IG_RegisterOnloadHandler(display);

			</script>
		]]>
	</Content>
</Module>
